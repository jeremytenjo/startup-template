import{onCall as E}from"firebase-functions/v2/https";function r(e){var i;let t=[],o={cause:{props:e,missingProps:t}};if(!e.props&&!e.condition)throw new Error("props are undefined",o);if(e.props){if(e.requiredProps&&((i=e.requiredProps)!=null&&i.length)&&e.requiredProps.forEach(a=>{var y;let P=String(a);if(((y=e.props)==null?void 0:y[P])===void 0)throw new Error(`Missing required prop: ${P}`,o)}),t.length)throw new Error(`Missing props: ${t.join(",")}`,o)}else if(!Boolean(e.condition))throw new Error("condition failed",o)}import g from"firebase-functions/logger";import{HttpsError as x}from"firebase-functions/v2/https";import{PostHog as A}from"posthog-node";var s={id:void 0,initContig:{api_host:"https://app.posthog.com",autocapture:!1,capture_pageleave:!1,capture_pageview:!1,disable_session_recording:!0}};async function u(e){var t;if(r({props:e,requiredProps:["eventName","data"]}),((t=process==null?void 0:process.env)==null?void 0:t.NODE_ENV)==="production"&&s.id){let o=new A(s.id);o.capture({distinctId:"nodePostHog",event:e.eventName,properties:{...e.data,metadata:e.data}}),await o.shutdownAsync()}}async function c(e){r({props:e,requiredProps:["description","fnName"]}),u({eventName:"Error",data:{description:String(e.description),functionName:e.fnName,uid:e.uid||"",metadata:e==null?void 0:e.metadata}})}function d(e){r({props:e,requiredProps:["description","fnName"]});let t={fnName:String(e.fnName),description:String(e.description),metadata:e.metadata,uid:e.uid};if(c(t),e.throwHttpsError)throw g.error(t.fnName+` - ${t.description}`,t),new x("failed-precondition",t.description);if(g.error(t.fnName+` - ${t.description}`,t),e.throwError)throw new Error(`${t.fnName} - ${t.description}`)}import F from"firebase-functions/logger";import R from"firebase-admin";R.initializeApp();function p(){return{firebaseAdmin:R}}var n="routes/deactivateAccount";async function m(e){var i,a;if(F.info(`START: ${n}`,{props:e}),r({props:e,requiredProps:["payload"]}),r({props:e.payload,requiredProps:["uid"]}),((i=e.payload)==null?void 0:i.uid)!==((a=e.authUser)==null?void 0:a.uid))throw new Error("User Id does not match Auth User Id");let{firebaseAdmin:t}=p();await t.auth().deleteUser(e.authUser.uid),await t.auth().deleteUser(e.authUser.uid);let o={data:[{success:!0}]};return F.info(`END: ${n}`,{response:o}),o}async function f(e){if(r({props:e,requiredProps:["context"]}),e.context.route===n)try{return await m({authUser:e.authUser,payload:e.context.payload})}catch(t){throw new Error(`${n} - ${t}`,{cause:t==null?void 0:t.cause})}throw new Error(`Action doesn't exist - ${e.context.route}`,{cause:{props:e}})}async function l(e){if(e.context.route.startsWith("routes/"))return await f(e);throw new Error(`Route doesn't exist - ${e.context.route}`,{cause:{props:e}})}async function h(e){var t,o;try{return await l({authUser:e.request.auth,context:e.request.data})}catch(i){d({fnName:"miscFunctions",description:i,uid:(o=(t=e.request)==null?void 0:t.auth)==null?void 0:o.uid,throwHttpsError:!0,metadata:i==null?void 0:i.cause})}}var Z=E({memory:"1GiB"},async e=>await h({request:e}));export{Z as miscFunctions};
